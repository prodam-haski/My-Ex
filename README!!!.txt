работающая(почти)(почти идеально) версия лежит в репозитории первой лабы.